<div class="top-fixed-container">

  <div class="progress-container">

    <div class="progress-description">
      <p>{{ stepTitles[progress] }}</p>
      <p *ngIf="progress !== 4">step {{ progress + 1}} of 4 </p>
    </div>

    <div class="progress-bar-container">
      <div
        class="progress-bar"
        [ngClass]="{
            'progress-bar-25': progress === 1,
            'progress-bar-50': progress === 2,
            'progress-bar-75': progress === 3,
            'progress-bar-100': progress === 4
          }">
      </div>
    </div>

  </div>

  <form *ngIf="progress === 1" class="ingredient-form" [formGroup]="ingredientForm">

      <div class="ingredients-inputs-container">

        <input
          #ing_name_input
          class="ipt-default"
          [ngClass]="{'highlight': editingIngIndex !== -1}"
          formControlName="productName"
          type="text"
          placeholder="name"
        >
        <div class="ingredients-second-row">
          <input
          class="ipt-default"
          [ngClass]="{'highlight': editingIngIndex !== -1}"
          formControlName="productQuantity"
          type="text"
          placeholder="quantity"
        >
        <input
          class="ipt-default"
          [ngClass]="{'highlight': editingIngIndex !== -1}"
          formControlName="productUnit"
          type="text"
          list="units"
          placeholder="unit"
        >
        </div>

        <datalist id="units">
          <option *ngFor="let unit of units">{{ unit }}</option>
        </datalist>

      </div>

      <button
        *ngIf="editingIngIndex === -1"
        class="btn-default btn-add"
        [ngClass]="{ 'disabled': ingredientForm.invalid }"
        (click)="onAddIngredient()">
        Add
      </button>

      <button
        *ngIf="editingIngIndex !== -1"
        class="btn-default btn-save"
        [ngClass]="{ 'disabled': ingredientForm.invalid }"
        (click)="onSaveChangesClick()"
        >Save
      </button>

  </form>

  <form *ngIf="progress === 2" class="steps-form" [formGroup]="stepForm">

    <textarea
      #step_input
      class="ipt-default"
      formControlName="step"
      cols="30"
      rows="2"
      placeholder="Preparation Step">
    </textarea>

    <button
      *ngIf="editingStepIndex === -1"
      class="btn-default btn-add"
      [ngClass]="{'disabled': stepForm.invalid}"
      (click)="onAddStep()">
      Add
    </button>

    <button
      *ngIf="editingStepIndex !== -1"
      class="btn-default btn-save"
      [ngClass]="{'disabled': stepForm.invalid}"
      (click)="onSaveStepChangesClick()">
      Save
    </button>

  </form>

  <form *ngIf="progress === 3" class="tags-form" [formGroup]="tagsForm">

      <textarea
        class="ipt-default"
        formControlName="tag"
        cols="30"
        rows="2"
        placeholder="Tag">
      </textarea>

      <button
        *ngIf="editingTagIndex === -1"
        class="btn-default btn-add"
        [ngClass]="{ 'disabled': tagsForm.invalid }"
        (click)="onAddTagClick()">
        Add
      </button>

      <button
        *ngIf="editingTagIndex !== -1"
        class="btn-default btn-save"
        [ngClass]="{ 'disabled': tagsForm.invalid }"
        (click)="onSaveTagChangesClick()">
        Save
      </button>

  </form>


</div>

<div class="full-width-flex-container">
  <div class="new-recipe-container">

    <!-- <div class="top-fixed-container">
      <div class="progress-container">
        <p class="p-progress">{{ stepTitles[progress] }}</p>
        <p *ngIf="progress !== 4" class="p-progress">step {{ progress + 1}} of 4 </p>
      </div>
      <div class="progression-bar-container">
        <div [ngClass]=" {'progression-bar-25' : progress === 1, 'progression-bar-50' : progress === 2, 'progression-bar-75': progress===3, 'progression-bar-100': progress===4}" class="progression-bar"></div>
      </div>


      <form *ngIf="progress === 2" [formGroup]="stepForm">
        <div class="step-form-container">
          <input #step_input class="ipt-default" formControlName="step" type="text" placeholder="Preparation Step">
          <button [ngClass]="!stepForm.valid ? 'disabled' : ''" *ngIf="editingStepIndex === -1" class="btn-default btn-add" (click)="onAddStep()" >Add</button>
          <button  [ngClass]="!stepForm.valid ? 'disabled' : ''" *ngIf="editingStepIndex !== -1"class="btn-default btn-save" (click)="onSaveStepChangesClick()" >Save</button>
        </div>
      </form>

      <form  *ngIf="progress === 3" [formGroup]="tagsForm">
        <div class="tag-form-container">
          <input
          class="ipt-default"
          formControlName="tag"
          id="tags"
          type="text"
          placeholder="tag"
          >
          <button [ngClass]="tagsForm.invalid ? 'disabled' : ''" *ngIf="editingTagIndex === -1" class="btn-default btn-add" (click)="onAddTagClick()">Add</button>
          <button [ngClass]="!tagsForm.valid ? 'disabled' : ''" *ngIf="editingTagIndex !== -1" class="btn-default btn-save" (click)="onSaveTagChangesClick()" >Save</button>

        </div>
      </form>
    </div>

-->

    <form *ngIf="progress === 0" class="recipe-form" [formGroup]="recipeForm">

      <div class="recipe-input-container">

        <label for="name" class="lbl-default">Name</label>
        <input
          class="ipt-default"
          formControlName="name"
          id="name"
          type="text">

      </div>

      <div class="recipe-input-container">

        <label for="prep-time" class="lbl-default">Preparation Time (mins)</label>
        <input
          class="ipt-default"
          formControlName="prepTime"
          id="prep-time"
          type="text">

      </div>

      <div class="recipe-input-container">

        <label for="servings" class="lbl-default">Servings</label>
        <input
          class="ipt-default"
          formControlName="servings"
          id="servings"
          type="text">

      </div>

      <div class="recipe-input-container">

        <label for="difficulty" class="lbl-default">Difficulty</label>
        <select
          class="ipt-default"
          formControlName="difficulty"
          id="difficulty"
        >
          <option value="easy">easy</option>
          <option value="medium">medium</option>
          <option value="hard">hard</option>
        </select>

      </div>

      <div class="recipe-input-container">

        <label for="description" class="lbl-default">Description</label>
        <textarea
          formControlName="description"
          class="ipt-default"
          id="description"
          cols="30"
          rows="5">
        </textarea>

      </div>

    </form>

    <div *ngIf="progress === 1" class="ingredients-container">

      <div *ngFor="let ingredient of recipe.ingredients; let i = index" class="list-el-container">

        <div [ngClass]="{'active-ingredient': editingIngIndex === i || (this.btnsOpened && this.btnsOpened.id === i && this.btnsOpened.open) }" class="ingredient">

          <p>{{ ingredient.name }}</p>
          <p>{{ ingredient.quantity }}</p>
          <p>{{ ingredient.unit }}</p>

          <div *ngIf="editingIngIndex === i || (this.btnsOpened && this.btnsOpened.id === i && this.btnsOpened.open)" class="btns-container">

            <button
              *ngIf="editingIngIndex !== i"
              class="btn-default"
              (click)="onEditIngClick(i)"
              >
              Edit
            </button>

            <button
              *ngIf="editingIngIndex !== i"
              class="btn-default"
              (click)="onDeleteIngClick(i)"
              >
              Delete
            </button>

          </div>

        </div>

        <button class="btns-show" (click)="onMoreClick(i)">
          <img src="../../../assets/more-vertical-svgrepo-com.svg" alt="">
        </button>
      </div>

    </div>

    <!-- <form [formGroup]="recipeForm">
      <div class="recipe-form-container">
        </div>
        <div *ngIf="progress === 1" class="ingredients-container">
          <ul>
            <li class="lst" *ngFor="let product of recipe.ingredients; let i = index">
              <p class="list-element">{{product.name}} {{ product.quantity }} {{ product.unit }}</p>
              <button class="btn-more" (click)="onMoreClick('ings', i)">
                <img src="../../../assets/more-vertical-svgrepo-com.svg" alt="">
                <div *ngIf="moreMenu && moreMenu.id === i && moreMenu.open" class="more-menu">
                  <button (click)="onDeleteIngClick(i)" class="btn-default">delete</button>
                  <button (click)="onEditIngClick(i)"class="btn-default">edit</button>
                </div>
              </button>
            </li>
          </ul>
        </div>
        <div *ngIf="progress === 2" class="preparation-container">
          <ul>
            <li class="lst" *ngFor="let step of recipe.prepSteps; let i = index">
              <p class="list-element">{{ step }}</p>
              <button class="btn-more" (click)="onMoreClick('step', i)">
                <img src="../../../assets/more-vertical-svgrepo-com.svg" alt="">
                <div *ngIf="moreMenu && moreMenu.id === i && moreMenu.open" class="more-menu">
                  <button (click)="onDeleteStepClick(i)" class="btn-default">delete</button>
                  <button (click)="onEditStepClick(i)"class="btn-default">edit</button>
                </div>
              </button>
            </li>

          </ul>
        </div>

        <div *ngIf="progress === 3" class="tags-container">

          <li class="lst" *ngFor="let tag of recipe.tags; let i = index">
            <p class="list-element">{{ tag }}</p>
            <button class="btn-more" (click)="onMoreClick('tag', i)">
              <img src="../../../assets/more-vertical-svgrepo-com.svg" alt="">
              <div *ngIf="moreMenu && moreMenu.id === i && moreMenu.open" class="more-menu">
                <button (click)="onDeleteTagClick(i)" class="btn-default">delete</button>
                <button (click)="onEditTagClick(i)"class="btn-default">edit</button>
              </div>
            </button>
          </li>
        </div>

        <div *ngIf="progress === 4">
          <app-recipe [recipe]="recipe"></app-recipe>
        </div>



        <div class="btns-container">
          <button *ngIf="progress !== 0" (click)="onBackClick()" class="btn-default" [ngClass]="recipeForm.valid ? '' : 'disabled'">Back</button>
          <button *ngIf="progress !== 4" (click)="onNextClick()" class="btn-default" [ngClass]="recipeForm.valid ? '' : 'disabled'">Next</button>

          <button *ngIf="!editMode && progress === 4" type="button" class="btn-default" (click)="onAddRecipe()">Add Recipe</button>
          <button *ngIf="editMode && progress === 4" type="button" class="btn-default" (click)="onSaveChanges(recipe)">Save Changes</button>
        </div>



      </div>
    </form>  -->


  </div>
</div>

<div class="bottom-fixed-container">

  <button
    *ngIf="progress !== 0"
    class="btn-default"
    [ngClass]="recipeForm.valid ? '' : 'disabled'"
    (click)="onBackClick()">
    Back
  </button>

  <button
    *ngIf="progress !== 4"
    class="btn-default"
    [ngClass]="recipeForm.valid ? '' : 'disabled'"
    (click)="onNextClick()">
    Next
  </button>

  <button
    *ngIf="!editMode && progress === 4"
    class="btn-default"
    (click)="onAddRecipe()">
    Add Recipe
  </button>

  <button
    *ngIf="editMode && progress === 4"
    class="btn-default"
    (click)="onSaveChanges(recipe)">
    Save Changes
  </button>

</div>
